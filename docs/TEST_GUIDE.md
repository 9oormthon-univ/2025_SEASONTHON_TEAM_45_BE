# 테스트 가이드

CareFreePass 시스템의 테스트 페이지 사용법과 전체적인 테스트 방법을 안내합니다.

## 🧪 테스트 페이지 개요

웹 기반 테스트 인터페이스를 통해 CareFreePass의 모든 기능을 쉽게 테스트할 수 있습니다.

**테스트 페이지 URL**: `http://localhost:8080/test-fcm.html`

### 제공되는 기능
- 👤 환자 회원가입
- 📱 FCM 토큰 생성 및 등록  
- 🏥 예약 생성/수정/삭제
- 📋 예약 목록 조회 및 관리
- 📞 환자 호출 및 알림 테스트
- 🔄 예약 상태 변경

## 🚀 빠른 시작 가이드

### 1. 서버 실행
```bash
cd 2025_SEASONTHON_TEAM_45_BE
./gradlew bootRun --args='--spring.profiles.active=local'
```

### 2. 테스트 페이지 접속
브라우저에서 `http://localhost:8080/test-fcm.html` 접속

### 3. 5분 완전 테스트
1. **회원가입** (30초)
2. **FCM 토큰 생성** (30초)
3. **예약 생성** (30초)  
4. **환자 호출** (30초)
5. **알림 확인** (30초)

## 📱 FCM 토큰 테스트

### 1. 토큰 생성 과정
1. "🔄 실제 FCM 토큰 생성하기" 버튼 클릭
2. 브라우저 알림 권한 요청 → "허용" 클릭
3. 자동으로 토큰 생성 및 표시
4. 회원 ID 1에 자동 등록

### 2. 토큰 생성 성공 화면
```
✅ 생성된 FCM 토큰:
dSN96KjJ1zyWVGoDdnf2yp:APA91bFvJEKyLryZ0kJ1XXJN8wpQDrKV-tUM5oHvQbeVTa0JJ_9wMqnCkDZUH_mOOwvgZPx4OhqNt5HChK96IHUkdgQgEepJquGIpgyUInDtlB42cGw8ehE

✅ FCM 토큰이 성공적으로 등록되었습니다.
```

### 3. 문제 해결
**토큰 생성 실패 시:**
- 브라우저가 Chrome/Firefox인지 확인
- HTTPS 또는 localhost에서 실행 중인지 확인  
- 브라우저 개발자 도구에서 에러 메시지 확인

## 👤 회원가입 테스트

### 1. 기본 테스트 데이터
```
이름: 김환자
성별: 남성
생년월일: 19900315
전화번호: 01012345678  
비밀번호: password123!
```

### 2. 회원가입 성공 응답
```
✅ 회원가입 성공! 회원 ID: 2
```

### 3. 중복 회원가입 테스트
같은 전화번호로 재시도 시:
```
❌ 이미 등록된 전화번호입니다.
```

## 🏥 예약 관리 테스트

### 1. 예약 생성
#### 필수 입력값
```
회원 ID: 2 (방금 가입한 회원 ID 사용)
병원명: 서울대병원
진료과: 내과  
의사명: 김의사 (선택사항)
예약 날짜: 2025-08-30 (자동 설정)
예약 시간: 10:30
진료실: 2번 진료실 (선택사항)
```

#### 예약 생성 성공
```
✅ 예약이 성공적으로 생성되었습니다. (예약 ID: 15)
```

### 2. 예약 목록 확인
"목록 새로고침" 버튼 클릭하여 생성된 예약 확인

#### 예약 목록 화면
| 예약ID | 환자명 | 병원 | 진료과 | 예약시간 | 진료실 | 상태 | 액션 |
|--------|--------|------|--------|----------|--------|------|------|
| 15 | 김환자 | 서울대병원 | 내과 | 10:30 | 2번 진료실 | 예약됨 | 📢 호출, ✏️ 수정, 🗑️ 삭제 |

### 3. 예약 수정 테스트
1. "✏️ 수정" 버튼 클릭
2. 모달 창에서 정보 수정
3. "✅ 수정하기" 버튼 클릭

#### 수정 가능한 항목
- 병원명, 진료과, 의사명
- 예약 날짜, 예약 시간
- 진료실 번호

### 4. 예약 삭제 테스트  
1. "🗑️ 삭제" 버튼 클릭
2. 확인 대화상자에서 "확인" 클릭
3. 목록에서 해당 예약 제거 확인

## 📞 환자 호출 테스트

### 1. 호출 전 준비사항
✅ 회원가입 완료  
✅ FCM 토큰 등록 완료  
✅ 예약 생성 완료  
✅ **중요: 회원 ID가 일치해야 함**

### 2. 호출 실행
1. 예약 목록에서 "📢 호출" 버튼 클릭
2. 확인 대화상자에서 "확인" 클릭
3. 호출 완료 메시지 확인

### 3. 알림 수신 확인

#### A. 브라우저 네이티브 알림
브라우저 우상단에 시스템 알림 표시:
```
진료 호출
김환자님, 2번 진료실로 들어오세요.
```

#### B. 페이지 내 알림
페이지 우상단에 녹색 알림 박스:
```
📢 FCM 알림 수신!
제목: 진료 호출  
내용: 김환자님, 2번 진료실로 들어오세요.
```

#### C. 콘솔 로그 확인
개발자 도구(F12) → Console 탭:
```javascript
FCM 메시지 수신: {
  notification: {
    title: "진료 호출",
    body: "김환자님, 2번 진료실로 들어오세요."
  }
}
```

### 4. 상태 변경 확인
호출 후 예약 상태가 "호출됨"으로 변경 확인

## 🔄 상태 변경 테스트

### 예약 상태 흐름
```
BOOKED (예약됨) → ARRIVED (도착함) → CALLED (호출됨) → COMPLETED (완료됨)
```

### 각 상태별 테스트
1. **BOOKED**: 초기 생성 상태, 호출 가능
2. **ARRIVED**: 체크인 후 상태, 호출 가능  
3. **CALLED**: 호출 후 상태, 호출 가능
4. **COMPLETED**: 완료 상태, 호출 불가
5. **CANCELLED**: 취소 상태, 호출 불가

## 🚨 에러 상황 테스트

### 1. 회원 ID 불일치 테스트
```
시나리오: 회원 ID 1로 FCM 토큰 등록, 회원 ID 2로 예약 생성
결과: 호출 시 "환자의 FCM 토큰이 없습니다" 에러
해결: 동일한 회원 ID 사용
```

### 2. FCM 토큰 미등록 테스트
```
시나리오: 토큰 등록 없이 호출
결과: "환자의 FCM 토큰이 없습니다" 에러  
해결: FCM 토큰 먼저 등록
```

### 3. 완료된 예약 호출 테스트
```
시나리오: COMPLETED 상태 예약 호출
결과: "호출할 수 없는 예약 상태입니다" 에러
```

### 4. 중복 예약 생성 테스트
```
시나리오: 같은 날짜에 동일 환자 예약 재생성
결과: "해당 날짜에 이미 예약이 있습니다" 에러
```

## 🛠️ 디버깅 방법

### 1. 브라우저 개발자 도구 활용
**F12** → **Console** 탭에서 확인:
- FCM 토큰 생성 로그
- 네트워크 요청/응답
- JavaScript 에러

### 2. 네트워크 탭 확인
**F12** → **Network** 탭에서 API 호출 확인:
- 요청 URL 및 메서드
- 요청/응답 데이터
- HTTP 상태 코드

### 3. 서버 로그 확인
터미널에서 서버 로그 실시간 확인:
```bash
# 성공 로그 예시
INFO o.c.c.c.d.n.service.NotificationService : Patient call sent successfully: 김환자 (Appointment ID: 15)

# 실패 로그 예시  
ERROR o.c.c.c.d.n.service.NotificationService : Failed to send patient call: 김환자 (Appointment ID: 15)
```

## 📊 성능 테스트

### 1. 다중 예약 생성
여러 환자의 예약을 연속으로 생성하여 시스템 성능 확인

### 2. 동시 호출 테스트
여러 환자를 동시에 호출하여 FCM 전송 성능 확인

### 3. 대량 데이터 테스트
100+ 예약 생성 후 목록 조회 성능 확인

## 🔐 보안 테스트

### 1. SQL 인젝션 테스트
입력 필드에 특수 문자 입력하여 보안 확인:
```
병원명: '; DROP TABLE appointment; --
```

### 2. XSS 테스트  
스크립트 태그 입력하여 필터링 확인:
```
환자명: <script>alert('xss')</script>
```

## 📱 모바일 테스트

### 1. 반응형 디자인 확인
브라우저 개발자 도구에서 모바일 뷰 전환 (Ctrl+Shift+M)

### 2. 터치 인터페이스 테스트
모바일 기기에서 테스트 페이지 접속 및 기능 확인

## 🎯 자동화 테스트 스크립트

### JavaScript 테스트 함수
```javascript
// 전체 워크플로우 자동 테스트
async function runFullTest() {
    console.log('🚀 자동 테스트 시작');
    
    // 1. 회원가입
    await signUp();
    console.log('✅ 회원가입 완료');
    
    // 2. FCM 토큰 생성
    await generateAndRegisterFCMToken();
    console.log('✅ FCM 토큰 등록 완료');
    
    // 3. 예약 생성
    await createAppointment();
    console.log('✅ 예약 생성 완료');
    
    // 4. 예약 목록 새로고침
    await loadTodayAppointments();
    console.log('✅ 예약 목록 로드 완료');
    
    // 5. 환자 호출 (첫 번째 예약)
    const firstAppointment = document.querySelector('#appointmentsBody tr:first-child .call-btn');
    if (firstAppointment && !firstAppointment.disabled) {
        firstAppointment.click();
        console.log('✅ 환자 호출 완료');
    }
    
    console.log('🎉 전체 테스트 완료!');
}

// 브라우저 콘솔에서 실행
// runFullTest();
```

## 📋 테스트 체크리스트

### 기본 기능 테스트
- [ ] 서버 시작 확인
- [ ] 테스트 페이지 접속
- [ ] 회원가입 성공
- [ ] FCM 토큰 생성 성공
- [ ] 예약 생성 성공
- [ ] 예약 목록 조회 성공
- [ ] 환자 호출 성공
- [ ] 알림 수신 확인

### 예약 관리 테스트  
- [ ] 예약 수정 기능
- [ ] 예약 삭제 기능
- [ ] 상태 변경 기능
- [ ] 체크인 기능

### 에러 처리 테스트
- [ ] 중복 회원가입 차단
- [ ] 중복 예약 차단  
- [ ] FCM 토큰 미등록 에러
- [ ] 완료된 예약 호출 차단

### 알림 테스트
- [ ] 브라우저 네이티브 알림
- [ ] 페이지 내 알림 박스
- [ ] 서비스 워커 동작
- [ ] 백그라운드 메시지 수신

## 🔧 문제 해결 가이드

### 자주 발생하는 문제

#### 1. FCM 토큰 생성 실패
**원인**: 브라우저 권한 거부, 잘못된 Firebase 설정
**해결**: 알림 권한 허용, Firebase 설정 확인

#### 2. 알림이 안 옴
**원인**: 회원 ID 불일치, FCM 토큰 미등록
**해결**: 동일한 회원 ID로 토큰 등록 및 예약 생성

#### 3. 서버 연결 실패
**원인**: 서버 미실행, 포트 충돌
**해결**: 서버 재시작, 포트 8080 확인

#### 4. API 호출 실패  
**원인**: 네트워크 오류, 잘못된 요청 데이터
**해결**: 네트워크 탭에서 요청 확인, 서버 로그 점검

---

테스트 중 문제가 발생하면 위 디버깅 방법을 참조하거나, [API 문서](./API_DOCUMENTATION.md)에서 상세 스펙을 확인해주세요.